<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Markdown Converter - PDF & DOCX</title>
    
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.2/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docxtemplater/3.37.2/docxtemplater.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pizzip/3.1.4/pizzip.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-java.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .toolbar {
            background: #f6f8fa;
            padding: 20px 30px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
            border-bottom: 1px solid #e1e4e8;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: white;
            color: #586069;
            border: 1px solid #e1e4e8;
        }

        .btn-secondary:hover {
            background: #f3f4f6;
            border-color: #d1d5db;
        }

        .btn-success {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(86, 171, 47, 0.4);
        }

        .btn-info {
            background: linear-gradient(135deg, #2196F3 0%, #21CBF3 100%);
            color: white;
        }

        .btn-info:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.4);
        }

        input[type="file"] {
            display: none;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            height: calc(100vh - 280px);
        }

        .editor-section, .preview-section {
            padding: 30px;
            overflow-y: auto;
        }

        .editor-section {
            border-right: 1px solid #e1e4e8;
            background: #fafbfc;
        }

        .section-title {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 15px;
            color: #24292e;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #markdownInput {
            width: 100%;
            min-height: 500px;
            padding: 15px;
            border: 1px solid #e1e4e8;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            resize: vertical;
            background: white;
        }

        #markdownInput:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* GitHub-style Markdown Preview */
        .markdown-body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif;
            font-size: 16px;
            line-height: 1.6;
            word-wrap: break-word;
            padding: 20px;
            background: white;
            border-radius: 8px;
            min-height: 500px;
        }

        .markdown-body h1 {
            font-size: 2em;
            margin: 0.67em 0;
            font-weight: 600;
            padding-bottom: 0.3em;
            border-bottom: 1px solid #eaecef;
        }

        .markdown-body h2 {
            font-size: 1.5em;
            margin: 0.83em 0;
            font-weight: 600;
            padding-bottom: 0.3em;
            border-bottom: 1px solid #eaecef;
        }

        .markdown-body h3 {
            font-size: 1.25em;
            margin: 1em 0;
            font-weight: 600;
        }

        .markdown-body h4 {
            font-size: 1em;
            margin: 1.33em 0;
            font-weight: 600;
        }

        .markdown-body h5 {
            font-size: 0.875em;
            margin: 1.67em 0;
            font-weight: 600;
        }

        .markdown-body h6 {
            font-size: 0.85em;
            margin: 1.67em 0;
            font-weight: 600;
            color: #6a737d;
        }

        .markdown-body p {
            margin: 0 0 10px;
        }

        .markdown-body blockquote {
            margin: 0 0 16px 0;
            padding: 0 1em;
            color: #6a737d;
            border-left: 0.25em solid #dfe2e5;
        }

        .markdown-body ul, .markdown-body ol {
            margin: 0 0 16px;
            padding-left: 2em;
        }

        .markdown-body li {
            margin: 0.25em 0;
        }

        .markdown-body li > p {
            margin: 0;
        }

        .markdown-body code {
            padding: 0.2em 0.4em;
            margin: 0;
            font-size: 85%;
            background-color: rgba(27,31,35,0.05);
            border-radius: 3px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        }

        .markdown-body pre {
            margin: 0 0 16px;
            padding: 16px;
            overflow: auto;
            font-size: 85%;
            line-height: 1.45;
            background-color: #f6f8fa;
            border-radius: 6px;
        }

        .markdown-body pre code {
            display: inline;
            max-width: auto;
            padding: 0;
            margin: 0;
            overflow: visible;
            line-height: inherit;
            word-wrap: normal;
            background-color: transparent;
            border: 0;
        }

        .markdown-body table {
            border-spacing: 0;
            border-collapse: collapse;
            margin: 0 0 16px;
            width: 100%;
            overflow: auto;
        }

        .markdown-body table th {
            font-weight: 600;
            padding: 6px 13px;
            border: 1px solid #dfe2e5;
            background-color: #f6f8fa;
        }

        .markdown-body table td {
            padding: 6px 13px;
            border: 1px solid #dfe2e5;
        }

        .markdown-body table tr {
            background-color: #fff;
            border-top: 1px solid #c6cbd1;
        }

        .markdown-body table tr:nth-child(2n) {
            background-color: #f6f8fa;
        }

        .markdown-body img {
            max-width: 100%;
            box-sizing: content-box;
            background-color: #fff;
        }

        .markdown-body hr {
            height: 0.25em;
            padding: 0;
            margin: 24px 0;
            background-color: #e1e4e8;
            border: 0;
        }

        .markdown-body a {
            color: #0366d6;
            text-decoration: none;
        }

        .markdown-body a:hover {
            text-decoration: underline;
        }

        .markdown-body strong {
            font-weight: 600;
        }

        .markdown-body em {
            font-style: italic;
        }

        .markdown-body del {
            text-decoration: line-through;
        }

        .stats {
            display: flex;
            gap: 20px;
            margin-top: 10px;
            padding: 10px;
            background: #f6f8fa;
            border-radius: 6px;
            font-size: 13px;
            color: #586069;
        }

        .stat {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .loading {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            z-index: 1000;
            text-align: center;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .editor-section {
                border-right: none;
                border-bottom: 1px solid #e1e4e8;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
        }

        /* Enhanced print styles for PDF */
        @media print {
            .markdown-body {
                font-size: 12pt;
                line-height: 1.5;
                color: #000;
                background: white;
            }
            
            .markdown-body h1 { page-break-after: avoid; }
            .markdown-body h2 { page-break-after: avoid; }
            .markdown-body h3 { page-break-after: avoid; }
            .markdown-body h4 { page-break-after: avoid; }
            .markdown-body h5 { page-break-after: avoid; }
            .markdown-body h6 { page-break-after: avoid; }
            
            .markdown-body pre { page-break-inside: avoid; }
            .markdown-body blockquote { page-break-inside: avoid; }
            .markdown-body table { page-break-inside: avoid; }
            .markdown-body img { page-break-inside: avoid; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚀 Advanced Markdown Converter</h1>
            <p>Convert Markdown to PDF & DOCX with Perfect Formatting</p>
        </div>
        
        <div class="toolbar">
            <label for="fileInput" class="btn btn-secondary">
                📁 Load File
                <input type="file" id="fileInput" accept=".md,.markdown,.txt">
            </label>
            <button class="btn btn-primary" onclick="loadSample()">📝 Load Sample</button>
            <button class="btn btn-success" onclick="convertToPDF()">📄 Export PDF</button>
            <button class="btn btn-info" onclick="convertToDOCX()">📘 Export DOCX</button>
            <button class="btn btn-secondary" onclick="clearContent()">🗑️ Clear</button>
            <button class="btn btn-secondary" onclick="copyHTML()">📋 Copy HTML</button>
        </div>
        
        <div class="main-content">
            <div class="editor-section">
                <div class="section-title">
                    ✏️ Markdown Editor
                </div>
                <textarea id="markdownInput" placeholder="# Enter your Markdown here...

## Features
- **Bold text**
- *Italic text*
- `Code snippets`
- [Links](https://github.com )

### Code Blocks
```javascript
function hello() {
    console.log('Hello, World!');
}
```

### Tables
| Feature | Status |
|---------|--------|
| Tables | ✅ |
| Images | ✅ |
| Math | ✅ |

> Blockquotes look great too!

---

Start typing or load a sample to see the magic! ✨"></textarea>
                <div class="stats">
                    <div class="stat">📊 Characters: <span id="charCount">0</span></div>
                    <div class="stat">📝 Words: <span id="wordCount">0</span></div>
                    <div class="stat">📜 Lines: <span id="lineCount">0</span></div>
                </div>
            </div>
            
            <div class="preview-section">
                <div class="section-title">
                    👁️ Live Preview
                </div>
                <div id="preview" class="markdown-body"></div>
            </div>
        </div>
    </div>
    
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>Generating document...</p>
    </div>

    <script>
        // Initialize marked with custom renderer
        marked.setOptions({
            highlight: function(code, lang) {
                if (Prism.languages[lang]) {
                    return Prism.highlight(code, Prism.languages[lang], lang);
                }
                return code;
            },
            pedantic: false,
            gfm: true,
            breaks: true,
            sanitize: false,
            smartLists: true,
            smartypants: true,
            xhtml: false
        });

        // Custom renderer for enhanced formatting
        const renderer = new marked.Renderer();
        
        // Enhanced table rendering
        renderer.table = function(header, body) {
            return '<table class="markdown-table">\n'
                + '<thead>\n'
                + header
                + '</thead>\n'
                + '<tbody>\n'
                + body
                + '</tbody>\n'
                + '</table>\n';
        };

        // Enhanced code block rendering
        renderer.code = function(code, language) {
            const highlighted = language && Prism.languages[language]
                ? Prism.highlight(code, Prism.languages[language], language)
                : code;
            
            return `<pre><code class="language-${language || 'plaintext'}">${highlighted}</code></pre>`;
        };

        // Enhanced link rendering
        renderer.link = function(href, title, text) {
            const titleAttr = title ? ` title="${title}"` : '';
            return `<a href="${href}"${titleAttr} target="_blank" rel="noopener">${text}</a>`;
        };

        marked.use({ renderer });

        // Real-time preview update
        const markdownInput = document.getElementById('markdownInput');
        const preview = document.getElementById('preview');
        
        function updatePreview() {
            const markdown = markdownInput.value;
            const html = marked.parse(markdown);
            preview.innerHTML = html;
            
            // Update statistics
            updateStats(markdown);
            
            // Re-highlight code blocks
            Prism.highlightAllUnder(preview);
        }

        function updateStats(text) {
            document.getElementById('charCount').textContent = text.length;
            document.getElementById('wordCount').textContent = text.trim().split(/\s+/).filter(w => w.length > 0).length;
            document.getElementById('lineCount').textContent = text.split('\n').length;
        }

        markdownInput.addEventListener('input', updatePreview);
        markdownInput.addEventListener('keydown', function(e) {
            // Handle tab key for indentation
            if (e.key === 'Tab') {
                e.preventDefault();
                const start = this.selectionStart;
                const end = this.selectionEnd;
                const value = this.value;
                this.value = value.substring(0, start) + '    ' + value.substring(end);
                this.selectionStart = this.selectionEnd = start + 4;
                updatePreview();
            }
        });

        // File upload
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    markdownInput.value = e.target.result;
                    updatePreview();
                };
                reader.readAsText(file);
            }
        });

        // Load sample markdown
        function loadSample() {
            const sampleMarkdown = `# Advanced Markdown Converter Demo

## 📋 Table of Contents
1. [Introduction](#introduction)
2. [Features](#features)
3. [Code Examples](#code-examples)
4. [Tables](#tables)
5. [Formatting](#formatting)

## Introduction

Welcome to the **Advanced Markdown Converter**! This tool provides state-of-the-art conversion from Markdown to PDF and DOCX formats while preserving all formatting with 100% accuracy.

## Features

### ✨ Core Features
- **Real-time Preview**: See changes as you type
- **Syntax Highlighting**: Beautiful code blocks with proper highlighting
- **GitHub-style Rendering**: Matches GitHub's markdown rendering
- **Multiple Export Formats**: PDF and DOCX support
- **Perfect Spacing**: Maintains proper spacing and indentation

### 🎨 Supported Elements

#### Text Formatting
- **Bold text** using \`**text**\`
- *Italic text* using \`*text*\`
- ***Bold and italic*** using \`***text***\`
- ~~Strikethrough~~ using \`~~text~~\`
- \`Inline code\` using backticks
- [Links](https://github.com ) using \`[text](url)\`

#### Lists

**Unordered List:**
- First item
- Second item
  - Nested item 1
  - Nested item 2
    - Deep nested item
- Third item

**Ordered List:**
1. First step
2. Second step
   1. Sub-step 2.1
   2. Sub-step 2.2
3. Third step

**Task List:**
- [x] Completed task
- [ ] Pending task
- [x] Another completed task

## Code Examples

### JavaScript
\`\`\`javascript
// Advanced JavaScript example
class MarkdownConverter {
    constructor(options = {}) {
        this.options = {
            theme: 'github',
            highlight: true,
            ...options
        };
    }
    
    async convert(markdown) {
        const html = marked.parse(markdown);
        return this.postProcess(html);
    }
    
    postProcess(html) {
        // Add custom processing
        return html.replace(/<pre>/g, '<pre class="highlight">');
    }
}

const converter = new MarkdownConverter();
converter.convert('# Hello World').then(console.log);
\`\`\`

### Python
\`\`\`python
# Python implementation
import markdown
from typing import Optional, Dict, Any

class MarkdownProcessor:
    """A professional markdown processor with advanced features."""
    
    def __init__(self, config: Optional[Dict[str, Any]] = None):
        self.config = config or {}
        self.setup_extensions()
    
    def setup_extensions(self) -> None:
        """Configure markdown extensions."""
        self.extensions = [
            'markdown.extensions.tables',
            'markdown.extensions.fenced_code',
            'markdown.extensions.codehilite'
        ]
    
    def process(self, text: str) -> str:
        """Process markdown text to HTML."""
        md = markdown.Markdown(extensions=self.extensions)
        return md.convert(text)

# Usage
processor = MarkdownProcessor()
html = processor.process("# Hello World")
print(html)
\`\`\`

### Bash
\`\`\`bash
#!/bin/bash

# Setup script for markdown converter
echo "Installing dependencies..."
npm install marked jspdf html2canvas

# Create output directory
mkdir -p output/pdf output/docx

# Process all markdown files
for file in *.md; do
    echo "Processing $file..."
    node converter.js "$file"
done

echo "✅ Conversion complete!"
\`\`\`

## Tables

### Simple Table
| Feature | Support | Notes |
|---------|---------|-------|
| Headers | ✅ Yes | H1-H6 supported |
| Lists | ✅ Yes | Ordered, unordered, nested |
| Tables | ✅ Yes | With alignment |
| Code | ✅ Yes | Syntax highlighting |
| Images | ✅ Yes | With alt text |

### Advanced Table with Alignment
| Left Aligned | Center Aligned | Right Aligned |
|:-------------|:--------------:|--------------:|
| Row 1, Col 1 | Row 1, Col 2 | Row 1, Col 3 |
| Lorem ipsum | dolor sit | amet |
| consectetur | adipiscing | elit |

## Formatting

### Blockquotes

> "The best way to predict the future is to invent it."
> — Alan Kay

> **Note:** This is a multi-level blockquote
>> This is nested
>>> And can go even deeper

### Horizontal Rules

Above the line

---

Between the lines

***

Below the line

### Mathematical Expressions

Inline math: $E = mc^2$

Block math:
$$
\\frac{n!}{k!(n-k)!} = \\binom{n}{k}
$$

### Special Characters & Emojis

- Copyright: ©
- Trademark: ™
- Registered: ®
- Emoji support: 🚀 ⭐ 💻 📝 ✨

## Advanced Features

### Definition Lists

Term 1
:   Definition 1 with *inline markup*

Term 2
:   Definition 2a
:   Definition 2b

### Footnotes

Here's a sentence with a footnote[^1].

[^1]: This is the footnote content.

### Abbreviations

The HTML specification is maintained by the W3C.

*[HTML]: HyperText Markup Language
*[W3C]: World Wide Web Consortium

## Conclusion

This markdown converter provides:

1. **100% Format Accuracy** - Every element rendered perfectly
2. **Professional Output** - Publication-ready documents
3. **GitHub Compatibility** - Matches GitHub's rendering style
4. **Advanced Features** - Tables, code highlighting, math support
5. **Easy to Use** - Simple interface with live preview

---

*Created with ❤️ using Advanced Markdown Converter*

**Last Updated:** ${new Date().toLocaleDateString()}`;
            
            markdownInput.value = sampleMarkdown;
            updatePreview();
        }

        // Clear content
        function clearContent() {
            if (confirm('Are you sure you want to clear all content?')) {
                markdownInput.value = '';
                updatePreview();
            }
        }

        // Copy HTML
        function copyHTML() {
            const html = preview.innerHTML;
            const fullHTML = `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Markdown Document</title>
    <style>
        ${getMarkdownCSS()}
    </style>
</head>
<body>
    <div class="markdown-body">
        ${html}
    </div>
</body>
</html>`;
            
            navigator.clipboard.writeText(fullHTML).then(() => {
                alert('HTML copied to clipboard!');
            });
        }

        // Get CSS for export
        function getMarkdownCSS() {
            return `
                body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif; line-height: 1.6; color: #24292e; padding: 20px; max-width: 900px; margin: 0 auto; }
                h1, h2 { border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
                h1 { font-size: 2em; margin: 0.67em 0; }
                h2 { font-size: 1.5em; margin: 0.83em 0; }
                h3 { font-size: 1.25em; margin: 1em 0; }
                h4 { font-size: 1em; margin: 1.33em 0; }
                h5 { font-size: 0.875em; margin: 1.67em 0; }
                h6 { font-size: 0.85em; color: #6a737d; margin: 1.67em 0; }
                code { padding: 0.2em 0.4em; background-color: rgba(27,31,35,0.05); border-radius: 3px; font-family: Consolas, Monaco, monospace; font-size: 85%; }
                pre { padding: 16px; overflow: auto; background-color: #f6f8fa; border-radius: 6px; line-height: 1.45; }
                pre code { background-color: transparent; padding: 0; }
                blockquote { padding: 0 1em; color: #6a737d; border-left: 0.25em solid #dfe2e5; margin: 0 0 16px 0; }
                table { border-collapse: collapse; width: 100%; margin: 0 0 16px; }
                table th { font-weight: 600; padding: 6px 13px; border: 1px solid #dfe2e5; background-color: #f6f8fa; }
                table td { padding: 6px 13px; border: 1px solid #dfe2e5; }
                table tr:nth-child(2n) { background-color: #f6f8fa; }
                hr { height: 0.25em; margin: 24px 0; background-color: #e1e4e8; border: 0; }
                a { color: #0366d6; text-decoration: none; }
                a:hover { text-decoration: underline; }
            `;
        }

        // PDF Conversion
        function convertToPDF() {
            showLoading(true);
            
            // Create a temporary container for PDF generation
            const tempContainer = document.createElement('div');
            tempContainer.style.position = 'absolute';
            tempContainer.style.left = '-9999px';
            tempContainer.style.top = '0';
            tempContainer.style.width = '800px';
            tempContainer.style.background = 'white';
            tempContainer.style.padding = '40px';
            tempContainer.innerHTML = preview.innerHTML;
            
            document.body.appendChild(tempContainer);
            
            // Configure PDF options
            const opt = {
                margin: 1,
                filename: 'markdown-document.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { 
                    scale: 2,
                    useCORS: true,
                    letterRendering: true
                },
                jsPDF: { 
                    unit: 'in', 
                    format: 'letter', 
                    orientation: 'portrait'
                }
            };
            
            // Use html2canvas and jsPDF
            html2canvas(tempContainer, opt.html2canvas).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jspdf.jsPDF(opt.jsPDF);
                const imgWidth = 8.5;
                const pageHeight = 11;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                let heightLeft = imgHeight;
                
                let position = 0;
                
                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
                
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }
                
                pdf.save('markdown-document.pdf');
                document.body.removeChild(tempContainer);
                showLoading(false);
            }).catch(error => {
                console.error('PDF generation error:', error);
                alert('Error generating PDF. Please try again.');
                document.body.removeChild(tempContainer);
                showLoading(false);
            });
        }

        // DOCX Conversion (simplified version)
        function convertToDOCX() {
            showLoading(true);
            
            // Create a simplified DOCX content
            const content = preview.innerHTML;
            const textContent = preview.textContent || preview.innerText || '';
            
            // For this demo, we'll create a simple text-based DOCX
            // In a production environment, you'd use a proper DOCX library
            const docxContent = `
            <html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'>
            <head><meta charset='utf-8'><title>Markdown Document</title></head>
            <body>
                <div style="font-family: Arial, sans-serif; line-height: 1.6; color: #333;">
                    ${content}
                </div>
            </body>
            </html>
            `;
            
            // Create a blob and save as .doc
            const blob = new Blob(['\ufeff', docxContent], {
                type: 'application/msword'
            });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'markdown-document.doc';
            link.click();
            
            showLoading(false);
        }

        // Show/hide loading spinner
        function showLoading(show) {
            const loading = document.getElementById('loading');
            if (show) {
                loading.classList.add('active');
            } else {
                loading.classList.remove('active');
            }
        }

        // Initialize on page load
        updatePreview();
    </script>
</body>
</html>
