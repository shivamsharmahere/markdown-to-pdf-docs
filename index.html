<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Markdown Converter - PDF & DOCX</title>
    
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.2/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html-docx-js@0.4.1/dist/html-docx.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/puppeteer/1.20.0/puppeteer.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-java.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .toolbar {
            background: #f6f8fa;
            padding: 20px 30px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
            border-bottom: 1px solid #e1e4e8;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: white;
            color: #586069;
            border: 1px solid #e1e4e8;
        }

        .btn-secondary:hover {
            background: #f3f4f6;
            border-color: #d1d5db;
        }

        .btn-success {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(86, 171, 47, 0.4);
        }

        .btn-info {
            background: linear-gradient(135deg, #2196F3 0%, #21CBF3 100%);
            color: white;
        }

        .btn-info:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.4);
        }

        input[type="file"] {
            display: none;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            height: calc(100vh - 280px);
        }

        .editor-section, .preview-section {
            padding: 30px;
            overflow-y: auto;
        }

        .editor-section {
            border-right: 1px solid #e1e4e8;
            background: #fafbfc;
        }

        .section-title {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 15px;
            color: #24292e;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #markdownInput {
            width: 100%;
            min-height: 500px;
            padding: 15px;
            border: 1px solid #e1e4e8;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            resize: vertical;
            background: white;
        }

        #markdownInput:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* GitHub-style Markdown Preview */
        .markdown-body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif;
            font-size: 16px;
            line-height: 1.6;
            word-wrap: break-word;
            padding: 20px;
            background: white;
            border-radius: 8px;
            min-height: 500px;
        }

        .markdown-body h1 {
            font-size: 2em;
            margin: 0.67em 0;
            font-weight: 600;
            padding-bottom: 0.3em;
            border-bottom: 1px solid #eaecef;
        }

        .markdown-body h2 {
            font-size: 1.5em;
            margin: 0.83em 0;
            font-weight: 600;
            padding-bottom: 0.3em;
            border-bottom: 1px solid #eaecef;
        }

        .markdown-body h3 {
            font-size: 1.25em;
            margin: 1em 0;
            font-weight: 600;
        }

        .markdown-body h4 {
            font-size: 1em;
            margin: 1.33em 0;
            font-weight: 600;
        }

        .markdown-body h5 {
            font-size: 0.875em;
            margin: 1.67em 0;
            font-weight: 600;
        }

        .markdown-body h6 {
            font-size: 0.85em;
            margin: 1.67em 0;
            font-weight: 600;
            color: #6a737d;
        }

        .markdown-body p {
            margin: 0 0 10px;
        }

        .markdown-body blockquote {
            margin: 0 0 16px 0;
            padding: 0 1em;
            color: #6a737d;
            border-left: 0.25em solid #dfe2e5;
        }

        .markdown-body ul, .markdown-body ol {
            margin: 0 0 16px;
            padding-left: 2em;
        }

        .markdown-body li {
            margin: 0.25em 0;
        }

        .markdown-body li > p {
            margin: 0;
        }

        .markdown-body code {
            padding: 0.2em 0.4em;
            margin: 0;
            font-size: 85%;
            background-color: rgba(27,31,35,0.05);
            border-radius: 3px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        }

        .markdown-body pre {
            margin: 0 0 16px;
            padding: 16px;
            overflow: auto;
            font-size: 85%;
            line-height: 1.45;
            background-color: #f6f8fa;
            border-radius: 6px;
        }

        .markdown-body pre code {
            display: inline;
            max-width: auto;
            padding: 0;
            margin: 0;
            overflow: visible;
            line-height: inherit;
            word-wrap: normal;
            background-color: transparent;
            border: 0;
        }

        .markdown-body table {
            border-spacing: 0;
            border-collapse: collapse;
            margin: 0 0 16px;
            width: 100%;
            overflow: auto;
        }

        .markdown-body table th {
            font-weight: 600;
            padding: 6px 13px;
            border: 1px solid #dfe2e5;
            background-color: #f6f8fa;
        }

        .markdown-body table td {
            padding: 6px 13px;
            border: 1px solid #dfe2e5;
        }

        .markdown-body table tr {
            background-color: #fff;
            border-top: 1px solid #c6cbd1;
        }

        .markdown-body table tr:nth-child(2n) {
            background-color: #f6f8fa;
        }

        .markdown-body img {
            max-width: 100%;
            box-sizing: content-box;
            background-color: #fff;
        }

        .markdown-body hr {
            height: 0.25em;
            padding: 0;
            margin: 24px 0;
            background-color: #e1e4e8;
            border: 0;
        }

        .markdown-body a {
            color: #0366d6;
            text-decoration: none;
        }

        .markdown-body a:hover {
            text-decoration: underline;
        }

        .markdown-body strong {
            font-weight: 600;
        }

        .markdown-body em {
            font-style: italic;
        }

        .markdown-body del {
            text-decoration: line-through;
        }

        .stats {
            display: flex;
            gap: 20px;
            margin-top: 10px;
            padding: 10px;
            background: #f6f8fa;
            border-radius: 6px;
            font-size: 13px;
            color: #586069;
        }

        .stat {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .loading {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            z-index: 1000;
            text-align: center;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .editor-section {
                border-right: none;
                border-bottom: 1px solid #e1e4e8;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
        }

        /* Enhanced print styles for PDF */
        @media print {
            body {
                margin: 0;
                padding: 0;
                background: white !important;
            }
            
            .markdown-body {
                font-size: 11pt !important;
                line-height: 1.4 !important;
                color: #000 !important;
                background: white !important;
                padding: 20pt !important;
                margin: 0 !important;
                box-shadow: none !important;
                border-radius: 0 !important;
                max-width: none !important;
            }
            
            .markdown-body h1 { 
                page-break-after: avoid; 
                font-size: 18pt !important;
                margin: 12pt 0 6pt 0 !important;
                padding-bottom: 3pt !important;
            }
            .markdown-body h2 { 
                page-break-after: avoid; 
                font-size: 15pt !important;
                margin: 10pt 0 5pt 0 !important;
                padding-bottom: 2pt !important;
            }
            .markdown-body h3 { 
                page-break-after: avoid; 
                font-size: 13pt !important;
                margin: 8pt 0 4pt 0 !important;
            }
            .markdown-body h4 { 
                page-break-after: avoid; 
                font-size: 11pt !important;
                margin: 6pt 0 3pt 0 !important;
                font-weight: 600 !important;
            }
            .markdown-body h5 { 
                page-break-after: avoid; 
                font-size: 10pt !important;
                margin: 5pt 0 2pt 0 !important;
                font-weight: 600 !important;
            }
            .markdown-body h6 { 
                page-break-after: avoid; 
                font-size: 9pt !important;
                margin: 4pt 0 2pt 0 !important;
                font-weight: 600 !important;
                color: #666 !important;
            }
            
            .markdown-body p { 
                margin: 0 0 6pt 0 !important;
                orphans: 3;
                widows: 3;
            }
            
            .markdown-body pre { 
                page-break-inside: avoid; 
                background-color: #f8f8f8 !important;
                border: 1pt solid #ddd !important;
                padding: 8pt !important;
                margin: 6pt 0 !important;
                font-size: 9pt !important;
                line-height: 1.3 !important;
            }
            
            .markdown-body code {
                background-color: #f0f0f0 !important;
                padding: 1pt 2pt !important;
                font-size: 9pt !important;
                border-radius: 2pt !important;
            }
            
            .markdown-body blockquote { 
                page-break-inside: avoid; 
                border-left: 3pt solid #ddd !important;
                padding-left: 8pt !important;
                margin: 6pt 0 6pt 0 !important;
                color: #666 !important;
            }
            
            .markdown-body table { 
                page-break-inside: avoid;
                border-collapse: collapse !important;
                width: 100% !important;
                margin: 6pt 0 !important;
            }
            
            .markdown-body table th {
                background-color: #f5f5f5 !important;
                border: 1pt solid #ddd !important;
                padding: 4pt 6pt !important;
                font-weight: 600 !important;
                font-size: 10pt !important;
            }
            
            .markdown-body table td {
                border: 1pt solid #ddd !important;
                padding: 4pt 6pt !important;
                font-size: 10pt !important;
            }
            
            .markdown-body ul, .markdown-body ol {
                margin: 4pt 0 4pt 0 !important;
                padding-left: 16pt !important;
            }
            
            .markdown-body li {
                margin: 1pt 0 !important;
                line-height: 1.3 !important;
            }
            
            .markdown-body hr {
                height: 1pt !important;
                background-color: #ddd !important;
                border: none !important;
                margin: 12pt 0 !important;
            }
            
            .markdown-body img { 
                page-break-inside: avoid; 
                max-width: 100% !important;
                height: auto !important;
            }
            
            .markdown-body a {
                color: #0066cc !important;
                text-decoration: underline !important;
            }
            
            /* Hide unnecessary elements in print */
            .toolbar, .section-title, .stats {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚀 Advanced Markdown Converter</h1>
            <p>Convert Markdown to PDF & DOCX with Perfect Formatting</p>
        </div>
        
        <div class="toolbar">
            <label for="fileInput" class="btn btn-secondary">
                📁 Load File
                <input type="file" id="fileInput" accept=".md,.markdown,.txt">
            </label>
            <button class="btn btn-primary" onclick="loadSample()">📝 Load Sample</button>
            <button class="btn btn-success" onclick="convertToPDF()">📄 Export PDF</button>
            <button class="btn btn-success" onclick="convertToPDFViaWindow()">📄 PDF (Window)</button>
            <button class="btn btn-success" onclick="convertToPDFViaBrowser()">📄 PDF (Direct)</button>
            <button class="btn btn-info" onclick="convertToDOCX()">📘 Export DOCX</button>
            <button class="btn btn-secondary" onclick="clearContent()">🗑️ Clear</button>
            <button class="btn btn-secondary" onclick="copyHTML()">📋 Copy HTML</button>
        </div>
        
        <div class="main-content">
            <div class="editor-section">
                <div class="section-title">
                    ✏️ Markdown Editor
                </div>
                <textarea id="markdownInput" placeholder="# Enter your Markdown here...

## Features
- **Bold text**
- *Italic text*
- `Code snippets`
- [Links](https://github.com )

### Code Blocks
```javascript
function hello() {
    console.log('Hello, World!');
}
```

### Tables
| Feature | Status |
|---------|--------|
| Tables | ✅ |
| Images | ✅ |
| Math | ✅ |

> Blockquotes look great too!

---

Start typing or load a sample to see the magic! ✨"></textarea>
                <div class="stats">
                    <div class="stat">📊 Characters: <span id="charCount">0</span></div>
                    <div class="stat">📝 Words: <span id="wordCount">0</span></div>
                    <div class="stat">📜 Lines: <span id="lineCount">0</span></div>
                </div>
            </div>
            
            <div class="preview-section">
                <div class="section-title">
                    👁️ Live Preview
                </div>
                <div id="preview" class="markdown-body"></div>
            </div>
        </div>
    </div>
    
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>Generating document...</p>
    </div>

    <script>
        // Initialize marked with custom renderer
        marked.setOptions({
            highlight: function(code, lang) {
                if (Prism.languages[lang]) {
                    return Prism.highlight(code, Prism.languages[lang], lang);
                }
                return code;
            },
            pedantic: false,
            gfm: true,
            breaks: true,
            sanitize: false,
            smartLists: true,
            smartypants: true,
            xhtml: false
        });

        // Custom renderer for enhanced formatting
        const renderer = new marked.Renderer();
        
        // Enhanced table rendering
        renderer.table = function(header, body) {
            return '<table class="markdown-table">\n'
                + '<thead>\n'
                + header
                + '</thead>\n'
                + '<tbody>\n'
                + body
                + '</tbody>\n'
                + '</table>\n';
        };

        // Enhanced code block rendering
        renderer.code = function(code, language) {
            const highlighted = language && Prism.languages[language]
                ? Prism.highlight(code, Prism.languages[language], language)
                : code;
            
            return `<pre><code class="language-${language || 'plaintext'}">${highlighted}</code></pre>`;
        };

        // Enhanced link rendering
        renderer.link = function(href, title, text) {
            const titleAttr = title ? ` title="${title}"` : '';
            return `<a href="${href}"${titleAttr} target="_blank" rel="noopener">${text}</a>`;
        };

        marked.use({ renderer });

        // Real-time preview update
        const markdownInput = document.getElementById('markdownInput');
        const preview = document.getElementById('preview');
        
        function updatePreview() {
            const markdown = markdownInput.value;
            const html = marked.parse(markdown);
            preview.innerHTML = html;
            
            // Update statistics
            updateStats(markdown);
            
            // Re-highlight code blocks
            Prism.highlightAllUnder(preview);
        }

        function updateStats(text) {
            document.getElementById('charCount').textContent = text.length;
            document.getElementById('wordCount').textContent = text.trim().split(/\s+/).filter(w => w.length > 0).length;
            document.getElementById('lineCount').textContent = text.split('\n').length;
        }

        markdownInput.addEventListener('input', updatePreview);
        markdownInput.addEventListener('keydown', function(e) {
            // Handle tab key for indentation
            if (e.key === 'Tab') {
                e.preventDefault();
                const start = this.selectionStart;
                const end = this.selectionEnd;
                const value = this.value;
                this.value = value.substring(0, start) + '    ' + value.substring(end);
                this.selectionStart = this.selectionEnd = start + 4;
                updatePreview();
            }
        });

        // File upload
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    markdownInput.value = e.target.result;
                    updatePreview();
                };
                reader.readAsText(file);
            }
        });

        // Load sample markdown
        function loadSample() {
            const sampleMarkdown = `# Advanced Markdown Converter Demo

## 📋 Table of Contents
1. [Introduction](#introduction)
2. [Features](#features)
3. [Code Examples](#code-examples)
4. [Tables](#tables)
5. [Formatting](#formatting)

## Introduction

Welcome to the **Advanced Markdown Converter**! This tool provides state-of-the-art conversion from Markdown to PDF and DOCX formats while preserving all formatting with 100% accuracy.

## Features

### ✨ Core Features
- **Real-time Preview**: See changes as you type
- **Syntax Highlighting**: Beautiful code blocks with proper highlighting
- **GitHub-style Rendering**: Matches GitHub's markdown rendering
- **Multiple Export Formats**: PDF and DOCX support
- **Perfect Spacing**: Maintains proper spacing and indentation

### 🎨 Supported Elements

#### Text Formatting
- **Bold text** using \`**text**\`
- *Italic text* using \`*text*\`
- ***Bold and italic*** using \`***text***\`
- ~~Strikethrough~~ using \`~~text~~\`
- \`Inline code\` using backticks
- [Links](https://github.com ) using \`[text](url)\`

#### Lists

**Unordered List:**
- First item
- Second item
  - Nested item 1
  - Nested item 2
    - Deep nested item
- Third item

**Ordered List:**
1. First step
2. Second step
   1. Sub-step 2.1
   2. Sub-step 2.2
3. Third step

**Task List:**
- [x] Completed task
- [ ] Pending task
- [x] Another completed task

## Code Examples

### JavaScript
\`\`\`javascript
// Advanced JavaScript example
class MarkdownConverter {
    constructor(options = {}) {
        this.options = {
            theme: 'github',
            highlight: true,
            ...options
        };
    }
    
    async convert(markdown) {
        const html = marked.parse(markdown);
        return this.postProcess(html);
    }
    
    postProcess(html) {
        // Add custom processing
        return html.replace(/<pre>/g, '<pre class="highlight">');
    }
}

const converter = new MarkdownConverter();
converter.convert('# Hello World').then(console.log);
\`\`\`

### Python
\`\`\`python
# Python implementation
import markdown
from typing import Optional, Dict, Any

class MarkdownProcessor:
    """A professional markdown processor with advanced features."""
    
    def __init__(self, config: Optional[Dict[str, Any]] = None):
        self.config = config or {}
        self.setup_extensions()
    
    def setup_extensions(self) -> None:
        """Configure markdown extensions."""
        self.extensions = [
            'markdown.extensions.tables',
            'markdown.extensions.fenced_code',
            'markdown.extensions.codehilite'
        ]
    
    def process(self, text: str) -> str:
        """Process markdown text to HTML."""
        md = markdown.Markdown(extensions=self.extensions)
        return md.convert(text)

# Usage
processor = MarkdownProcessor()
html = processor.process("# Hello World")
print(html)
\`\`\`

### Bash
\`\`\`bash
#!/bin/bash

# Setup script for markdown converter
echo "Installing dependencies..."
npm install marked jspdf html2canvas

# Create output directory
mkdir -p output/pdf output/docx

# Process all markdown files
for file in *.md; do
    echo "Processing $file..."
    node converter.js "$file"
done

echo "✅ Conversion complete!"
\`\`\`

## Tables

### Simple Table
| Feature | Support | Notes |
|---------|---------|-------|
| Headers | ✅ Yes | H1-H6 supported |
| Lists | ✅ Yes | Ordered, unordered, nested |
| Tables | ✅ Yes | With alignment |
| Code | ✅ Yes | Syntax highlighting |
| Images | ✅ Yes | With alt text |

### Advanced Table with Alignment
| Left Aligned | Center Aligned | Right Aligned |
|:-------------|:--------------:|--------------:|
| Row 1, Col 1 | Row 1, Col 2 | Row 1, Col 3 |
| Lorem ipsum | dolor sit | amet |
| consectetur | adipiscing | elit |

## Formatting

### Blockquotes

> "The best way to predict the future is to invent it."
> — Alan Kay

> **Note:** This is a multi-level blockquote
>> This is nested
>>> And can go even deeper

### Horizontal Rules

Above the line

---

Between the lines

***

Below the line

### Mathematical Expressions

Inline math: $E = mc^2$

Block math:
$$
\\frac{n!}{k!(n-k)!} = \\binom{n}{k}
$$

### Special Characters & Emojis

- Copyright: ©
- Trademark: ™
- Registered: ®
- Emoji support: 🚀 ⭐ 💻 📝 ✨

## Advanced Features

### Definition Lists

Term 1
:   Definition 1 with *inline markup*

Term 2
:   Definition 2a
:   Definition 2b

### Footnotes

Here's a sentence with a footnote[^1].

[^1]: This is the footnote content.

### Abbreviations

The HTML specification is maintained by the W3C.

*[HTML]: HyperText Markup Language
*[W3C]: World Wide Web Consortium

## Conclusion

This markdown converter provides:

1. **100% Format Accuracy** - Every element rendered perfectly
2. **Professional Output** - Publication-ready documents
3. **GitHub Compatibility** - Matches GitHub's rendering style
4. **Advanced Features** - Tables, code highlighting, math support
5. **Easy to Use** - Simple interface with live preview

---

*Created with ❤️ using Advanced Markdown Converter*

**Last Updated:** ${new Date().toLocaleDateString()}`;
            
            markdownInput.value = sampleMarkdown;
            updatePreview();
        }

        // Clear content
        function clearContent() {
            if (confirm('Are you sure you want to clear all content?')) {
                markdownInput.value = '';
                updatePreview();
            }
        }

        // Copy HTML
        function copyHTML() {
            const html = preview.innerHTML;
            const markdownCSS = getMarkdownCSS();
            const fullHTML = '<!DOCTYPE html>' +
            '<html>' +
            '<head>' +
                '<meta charset="UTF-8">' +
                '<title>Markdown Document</title>' +
                '<style>' + markdownCSS + '</style>' +
            '</head>' +
            '<body>' +
                '<div class="markdown-body">' + html + '</div>' +
            '</body>' +
            '</html>';
            
            navigator.clipboard.writeText(fullHTML).then(() => {
                alert('HTML copied to clipboard!');
            });
        }

        // Get CSS for export
        function getMarkdownCSS() {
            return `
                body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif; line-height: 1.6; color: #24292e; padding: 20px; max-width: 900px; margin: 0 auto; }
                h1, h2 { border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
                h1 { font-size: 2em; margin: 0.67em 0; }
                h2 { font-size: 1.5em; margin: 0.83em 0; }
                h3 { font-size: 1.25em; margin: 1em 0; }
                h4 { font-size: 1em; margin: 1.33em 0; }
                h5 { font-size: 0.875em; margin: 1.67em 0; }
                h6 { font-size: 0.85em; color: #6a737d; margin: 1.67em 0; }
                code { padding: 0.2em 0.4em; background-color: rgba(27,31,35,0.05); border-radius: 3px; font-family: Consolas, Monaco, monospace; font-size: 85%; }
                pre { padding: 16px; overflow: auto; background-color: #f6f8fa; border-radius: 6px; line-height: 1.45; }
                pre code { background-color: transparent; padding: 0; }
                blockquote { padding: 0 1em; color: #6a737d; border-left: 0.25em solid #dfe2e5; margin: 0 0 16px 0; }
                table { border-collapse: collapse; width: 100%; margin: 0 0 16px; }
                table th { font-weight: 600; padding: 6px 13px; border: 1px solid #dfe2e5; background-color: #f6f8fa; }
                table td { padding: 6px 13px; border: 1px solid #dfe2e5; }
                table tr:nth-child(2n) { background-color: #f6f8fa; }
                hr { height: 0.25em; margin: 24px 0; background-color: #e1e4e8; border: 0; }
                a { color: #0366d6; text-decoration: none; }
                a:hover { text-decoration: underline; }
            `;
        }

        // Enhanced PDF Conversion with proper HTML-to-PDF
        function convertToPDF() {
            showLoading(true);
            
            try {
                // Create a clean HTML document for PDF generation
                const htmlContent = createCleanHTMLForExport();
                
                // Create temporary element with exact styling
                const element = document.createElement('div');
                element.className = 'pdf-container';
                element.innerHTML = htmlContent;
                
                // Apply exact styling to match preview
                element.style.cssText = `
                    padding: 40px;
                    background-color: white;
                    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
                    font-size: 16px;
                    line-height: 1.6;
                    color: #24292e;
                    max-width: 800px;
                    margin: 0 auto;
                `;
                
                // Add to document temporarily
                document.body.appendChild(element);
                
                // PDF options optimized for text-based content
                const opt = {
                    margin: [15, 15, 15, 15], // mm
                    filename: 'markdown-document.pdf',
                    image: { 
                        type: 'jpeg', 
                        quality: 0.95
                    },
                    html2canvas: { 
                        scale: 1,
                        useCORS: true,
                        letterRendering: true,
                        allowTaint: false,
                        backgroundColor: '#ffffff',
                        removeContainer: true,
                        scrollX: 0,
                        scrollY: 0,
                        width: 800,
                        height: window.innerHeight,
                        onclone: function(clonedDoc) {
                            // Apply styles to cloned document
                            const style = clonedDoc.createElement('style');
                            style.textContent = getPrintCSS();
                            clonedDoc.head.appendChild(style);
                        }
                    },
                    jsPDF: { 
                        unit: 'mm', 
                        format: 'a4', 
                        orientation: 'portrait',
                        compress: true
                    },
                    pagebreak: { 
                        mode: ['avoid-all', 'css'],
                        avoid: ['h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'pre', 'blockquote', 'table', 'img']
                    }
                };
                
                // Use html2pdf for better formatting preservation
                if (typeof html2pdf !== 'undefined') {
                    html2pdf().set(opt).from(element).save().then(() => {
                        document.body.removeChild(element);
                        showLoading(false);
                        console.log('PDF generated successfully');
                    }).catch(error => {
                        console.error('PDF generation error:', error);
                        document.body.removeChild(element);
                        fallbackPDFGeneration(); 
                    });
                } else {
                    document.body.removeChild(element);
                    fallbackPDFGeneration(); 
                }
                
            } catch (error) {
                console.error('PDF generation error:', error);
                fallbackPDFGeneration();
            }
        }

        // Simple PDF generation via new window
        function convertToPDFViaWindow() {
            showLoading(true);
            
            try {
                const htmlContent = createCleanHTMLForExport();
                const newWindow = window.open('', '_blank');
                
                newWindow.document.write('<!DOCTYPE html>');
                newWindow.document.write('<html><head>');
                newWindow.document.write('<meta charset="UTF-8">');
                newWindow.document.write('<title>Markdown Document</title>');
                newWindow.document.write('<style>');
                newWindow.document.write(getPrintCSS());
                newWindow.document.write('</style>');
                newWindow.document.write('</head><body>');
                newWindow.document.write('<div style="padding:20px;">');
                newWindow.document.write('<button onclick="window.print()" style="position:fixed;top:10px;right:10px;padding:10px;background:#007bff;color:white;border:none;border-radius:5px;cursor:pointer;z-index:1000;">🖨️ Print as PDF</button>');
                newWindow.document.write('<div class="markdown-body">');
                newWindow.document.write(htmlContent);
                newWindow.document.write('</div></div></body></html>');
                newWindow.document.close();
                
                showLoading(false);
                alert('New window opened! Click the "Print as PDF" button and choose "Save as PDF" in the print dialog.');
                
            } catch (error) {
                console.error('PDF window generation error:', error);
                showLoading(false);
            }
        }

        // Browser-native PDF generation - Direct download
        function convertToPDFViaBrowser() {
            showLoading(true);
            
            try {
                // Save current page state
                const originalTitle = document.title;
                const originalContent = document.body.innerHTML;
                
                // Create print-optimized content
                const htmlContent = createCleanHTMLForExport();
                const printCSS = getPrintCSS();
                
                // Replace page content temporarily for printing
                document.title = 'Markdown Document';
                const printStyles = '<style>' + printCSS + 
                    '.print-content {' +
                        'max-width: none !important;' +
                        'margin: 0 !important;' +
                        'padding: 20pt !important;' +
                        'background: white !important;' +
                    '}' +
                    '</style>';
                    
                const printContent = '<div class="print-content markdown-body">' + htmlContent + '</div>';
                document.body.innerHTML = printStyles + printContent;
                
                // Auto-trigger browser print dialog for PDF save
                setTimeout(() => {
                    // Show instruction and trigger print
                    alert('PDF Download: A print dialog will open. Please select "Save as PDF" or "Microsoft Print to PDF" as your destination.');
                    
                    window.print();
                    
                    // Restore original content after print dialog
                    setTimeout(() => {
                        document.title = originalTitle;
                        document.body.innerHTML = originalContent;
                        
                        // Reinitialize the app
                        initializeApp();
                        showLoading(false);
                    }, 2000);
                }, 500);
                
            } catch (error) {
                console.error('Browser PDF generation error:', error);
                showLoading(false);
                location.reload(); // Restore page if something goes wrong
            }
        }

        // Create standalone HTML document for perfect printing
        function createStandaloneHTML(content) {
            // Simple approach to avoid parsing issues
            alert('Opening printable page in new window...');
            return '';  // Simplified for now
        }

        // Reinitialize app after browser print
        function initializeApp() {
            // Reattach event listeners
            const markdownInput = document.getElementById('markdownInput');
            const preview = document.getElementById('preview');
            
            if (markdownInput && preview) {
                markdownInput.addEventListener('input', updatePreview);
                markdownInput.addEventListener('keydown', function(e) {
                    if (e.key === 'Tab') {
                        e.preventDefault();
                        const start = this.selectionStart;
                        const end = this.selectionEnd;
                        const value = this.value;
                        this.value = value.substring(0, start) + '    ' + value.substring(end);
                        this.selectionStart = this.selectionEnd = start + 4;
                        updatePreview();
                    }
                });
                
                // Reattach file input listener
                const fileInput = document.getElementById('fileInput');
                if (fileInput) {
                    fileInput.addEventListener('change', function(e) {
                        const file = e.target.files[0];
                        if (file) {
                            const reader = new FileReader();
                            reader.onload = function(e) {
                                markdownInput.value = e.target.result;
                                updatePreview();
                            };
                            reader.readAsText(file);
                        }
                    });
                }
                
                // Update preview to restore content
                updatePreview();
            }
        }

        // Perfect PDF Generation - Creates a clean printable page
        function generatePrintablePage() {
            showLoading(true);
            
            try {
                // Create the most accurate HTML representation
                const htmlContent = createCleanHTMLForExport();
                const printCSS = getPrintCSS();
                
                // Create a perfect standalone document
                const perfectHTML = '<!DOCTYPE html>' +
                '<html lang="en">' +
                '<head>' +
                    '<meta charset="UTF-8">' +
                    '<meta name="viewport" content="width=device-width, initial-scale=1.0">' +
                    '<title>Markdown Document - Ready for PDF</title>' +
                    '<style>' + printCSS + '</style>' +
                    '<style>' +
                        '@media screen {' +
                            'body { max-width: 800px; margin: 20px auto; padding: 20px; background: #f5f5f5; }' +
                            '.markdown-body { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }' +
                            '.print-instructions { background: #e3f2fd; border: 1px solid #1976d2; padding: 15px; margin-bottom: 20px; border-radius: 5px; }' +
                            '.print-button { background: #1976d2; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-right: 10px; }' +
                            '.print-button:hover { background: #1565c0; }' +
                        '}' +
                        '@media print {' +
                            'body { background: white !important; margin: 0 !important; padding: 0 !important; }' +
                            '.markdown-body { box-shadow: none !important; border-radius: 0 !important; padding: 20pt !important; margin: 0 !important; }' +
                            '.print-instructions, .print-button { display: none !important; }' +
                        '}' +
                    '</style>' +
                '</head>' +
                '<body>' +
                    '<div class="print-instructions">' +
                        '<h3>📄 Ready for PDF Export</h3>' +
                        '<p><strong>Instructions:</strong> Use Ctrl+P (Cmd+P on Mac) to open print dialog, then choose "Save as PDF" or "Microsoft Print to PDF".</p>' +
                        '<button class="print-button" onclick="window.print()">🖨️ Print/Save as PDF</button>' +
                        '<button class="print-button" onclick="window.close()">❌ Close</button>' +
                    '</div>' +
                    '<div class="markdown-body">' + htmlContent + '</div>' +
                '</body>' +
                '</html>';
                
                // Open in new window
                const printWindow = window.open('', '_blank', 'width=900,height=700,scrollbars=yes,resizable=yes');
                printWindow.document.write(perfectHTML);
                printWindow.document.close();
                
                // Focus the new window
                printWindow.focus();
                
                showLoading(false);
                
                // Show instructions to user
                setTimeout(() => {
                    alert('📄 Perfect PDF page opened!\n\n✅ The formatting matches your HTML preview exactly\n\n📝 Instructions:\n1. Press Ctrl+P (Cmd+P on Mac)\n2. Choose "Save as PDF" as destination\n3. Click Save\n\nThis method gives you the most accurate PDF output!');
                }, 1000);
                
            } catch (error) {
                console.error('Perfect PDF generation error:', error);
                showLoading(false);
                alert('Error creating printable page. Please try another PDF method.');
            }
        }

        // Fallback PDF generation method
        function fallbackPDFGeneration() {
            console.log('Using fallback PDF generation...');
            alert('PDF generation: Please use Ctrl+P to print this page and select "Save as PDF"');
            showLoading(false);
        }

        // DOCX Conversion (original working version)
        function convertToDOCX() {
            showLoading(true);
            
            // Create a simplified DOCX content
            const content = preview.innerHTML;
            const textContent = preview.textContent || preview.innerText || '';
            
            // For this demo, we'll create a simple text-based DOCX
            // In a production environment, you'd use a proper DOCX library
            const docxContent = `
            <html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'>
            <head><meta charset='utf-8'><title>Markdown Document</title></head>
            <body>
                <div style="font-family: Arial, sans-serif; line-height: 1.6; color: #333;">
                    ${content}
                </div>
            </body>
            </html>
            `;
            
            // Create a blob and save as .doc
            const blob = new Blob(['\ufeff', docxContent], {
                type: 'application/msword'
            });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'markdown-document.doc';
            link.click();
            
            showLoading(false);
        }

        // Create clean HTML content for export
        function createCleanHTMLForExport() {
            // Clone the preview content
            const content = preview.cloneNode(true);
            
            // Clean up any unwanted elements
            const unwantedElements = content.querySelectorAll('button, .btn, .toolbar, .stats');
            unwantedElements.forEach(el => el.remove());
            
            // Ensure proper spacing and formatting
            content.querySelectorAll('pre code').forEach(el => {
                el.style.whiteSpace = 'pre-wrap';
                el.style.wordBreak = 'break-word';
            });
            
            content.querySelectorAll('table').forEach(el => {
                el.style.borderCollapse = 'collapse';
                el.style.width = '100%';
                el.style.margin = '16px 0';
            });
            
            return content.innerHTML;
        }

        // Get CSS for print/PDF
        function getPrintCSS() {
            return `
                @page {
                    margin: 0.5in;
                    size: A4;
                }
                
                body {
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
                    font-size: 11pt;
                    line-height: 1.4;
                    color: #333;
                    margin: 0;
                    padding: 20pt;
                    background: white;
                }
                
                h1 { font-size: 18pt; margin: 12pt 0 6pt 0; padding-bottom: 3pt; border-bottom: 1pt solid #eee; page-break-after: avoid; }
                h2 { font-size: 15pt; margin: 10pt 0 5pt 0; padding-bottom: 2pt; border-bottom: 1pt solid #eee; page-break-after: avoid; }
                h3 { font-size: 13pt; margin: 8pt 0 4pt 0; page-break-after: avoid; }
                h4 { font-size: 11pt; margin: 6pt 0 3pt 0; font-weight: 600; page-break-after: avoid; }
                h5 { font-size: 10pt; margin: 5pt 0 2pt 0; font-weight: 600; page-break-after: avoid; }
                h6 { font-size: 9pt; margin: 4pt 0 2pt 0; font-weight: 600; color: #666; page-break-after: avoid; }
                
                p { margin: 0 0 6pt 0; orphans: 3; widows: 3; }
                
                ul, ol { margin: 4pt 0; padding-left: 16pt; }
                li { margin: 1pt 0; line-height: 1.3; }
                
                code { 
                    background-color: #f0f0f0; 
                    padding: 1pt 2pt; 
                    font-size: 9pt; 
                    border-radius: 2pt; 
                    font-family: Consolas, Monaco, monospace;
                }
                
                pre { 
                    background-color: #f8f8f8; 
                    border: 1pt solid #ddd; 
                    padding: 8pt; 
                    margin: 6pt 0; 
                    font-size: 9pt; 
                    line-height: 1.3; 
                    page-break-inside: avoid;
                    white-space: pre-wrap;
                    word-wrap: break-word;
                    font-family: Consolas, Monaco, monospace;
                }
                
                pre code { 
                    background-color: transparent; 
                    padding: 0; 
                    border: none;
                }
                
                blockquote { 
                    border-left: 3pt solid #ddd; 
                    padding-left: 8pt; 
                    margin: 6pt 0; 
                    color: #666; 
                    page-break-inside: avoid;
                }
                
                table { 
                    border-collapse: collapse; 
                    width: 100%; 
                    margin: 6pt 0; 
                    page-break-inside: avoid;
                }
                
                table th {
                    background-color: #f5f5f5; 
                    border: 1pt solid #ddd; 
                    padding: 4pt 6pt; 
                    font-weight: 600; 
                    font-size: 10pt;
                }
                
                table td {
                    border: 1pt solid #ddd; 
                    padding: 4pt 6pt; 
                    font-size: 10pt;
                }
                
                hr {
                    height: 1pt; 
                    background-color: #ddd; 
                    border: none; 
                    margin: 12pt 0;
                }
                
                img { 
                    max-width: 100%; 
                    height: auto; 
                    page-break-inside: avoid;
                }
                
                a { 
                    color: #0066cc; 
                    text-decoration: underline;
                }
            `;
        }

        // Get CSS for DOCX
        function getDOCXCSS() {
            return `
                body {
                    font-family: 'Times New Roman', serif;
                    font-size: 12pt;
                    line-height: 1.5;
                    color: #000;
                    margin: 1in;
                    background: white;
                }
                
                h1 { font-size: 18pt; font-weight: bold; margin: 12pt 0 6pt 0; }
                h2 { font-size: 16pt; font-weight: bold; margin: 10pt 0 5pt 0; }
                h3 { font-size: 14pt; font-weight: bold; margin: 8pt 0 4pt 0; }
                h4 { font-size: 12pt; font-weight: bold; margin: 6pt 0 3pt 0; }
                h5 { font-size: 11pt; font-weight: bold; margin: 5pt 0 2pt 0; }
                h6 { font-size: 10pt; font-weight: bold; margin: 4pt 0 2pt 0; }
                
                p { margin: 0 0 6pt 0; text-align: justify; }
                
                ul, ol { margin: 6pt 0; padding-left: 18pt; }
                li { margin: 2pt 0; }
                
                code { 
                    font-family: 'Courier New', monospace;
                    background-color: #f0f0f0; 
                    padding: 2pt; 
                    font-size: 10pt;
                }
                
                pre { 
                    font-family: 'Courier New', monospace;
                    background-color: #f8f8f8; 
                    border: 1pt solid #ccc; 
                    padding: 6pt; 
                    margin: 6pt 0; 
                    font-size: 10pt;
                    white-space: pre-wrap;
                }
                
                blockquote { 
                    border-left: 3pt solid #ccc; 
                    padding-left: 12pt; 
                    margin: 6pt 0 6pt 12pt; 
                    font-style: italic;
                }
                
                table { 
                    border-collapse: collapse; 
                    width: 100%; 
                    margin: 12pt 0;
                }
                
                table th, table td {
                    border: 1pt solid #000; 
                    padding: 6pt; 
                    text-align: left;
                }
                
                table th {
                    background-color: #f0f0f0; 
                    font-weight: bold;
                }
                
                hr {
                    border: none; 
                    border-top: 1pt solid #ccc; 
                    margin: 12pt 0;
                }
                
                a { 
                    color: blue; 
                    text-decoration: underline;
                }
            `;
        }

        // Convert HTML to RTF for better Word compatibility
        function convertHTMLToRTF(html) {
            // Simple HTML to RTF conversion
            let rtf = '{\\rtf1\\ansi\\deff0 {\\fonttbl {\\f0 Times New Roman;}}';
            rtf += '\\f0\\fs24 '; // Set font and size
            
            // Replace HTML tags with RTF codes
            html = html.replace(/<h1[^>]*>(.*?)<\/h1>/gi, '\\fs36\\b $1\\b0\\fs24\\par\\par');
            html = html.replace(/<h2[^>]*>(.*?)<\/h2>/gi, '\\fs32\\b $1\\b0\\fs24\\par\\par');
            html = html.replace(/<h3[^>]*>(.*?)<\/h3>/gi, '\\fs28\\b $1\\b0\\fs24\\par\\par');
            html = html.replace(/<h4[^>]*>(.*?)<\/h4>/gi, '\\fs24\\b $1\\b0\\fs24\\par\\par');
            html = html.replace(/<h5[^>]*>(.*?)<\/h5>/gi, '\\fs22\\b $1\\b0\\fs24\\par\\par');
            html = html.replace(/<h6[^>]*>(.*?)<\/h6>/gi, '\\fs20\\b $1\\b0\\fs24\\par\\par');
            
            html = html.replace(/<p[^>]*>(.*?)<\/p>/gi, '$1\\par\\par');
            html = html.replace(/<br\s*\/?>/gi, '\\par');
            html = html.replace(/<strong[^>]*>(.*?)<\/strong>/gi, '\\b $1\\b0');
            html = html.replace(/<b[^>]*>(.*?)<\/b>/gi, '\\b $1\\b0');
            html = html.replace(/<em[^>]*>(.*?)<\/em>/gi, '\\i $1\\i0');
            html = html.replace(/<i[^>]*>(.*?)<\/i>/gi, '\\i $1\\i0');
            html = html.replace(/<code[^>]*>(.*?)<\/code>/gi, '\\f1 $1\\f0');
            html = html.replace(/<pre[^>]*>(.*?)<\/pre>/gi, '\\f1\\fs20 $1\\f0\\fs24\\par');
            
            // Remove remaining HTML tags
            html = html.replace(/<[^>]*>/g, '');
            
            // Escape special RTF characters
            html = html.replace(/\\/g, '\\\\');
            html = html.replace(/\{/g, '\\{');
            html = html.replace(/\}/g, '\\}');
            
            rtf += html + '}';
            return rtf;
        }

        // Fallback DOCX generation
        function fallbackDOCXGeneration() {
            const content = createCleanHTMLForExport();
            const textContent = preview.textContent || preview.innerText || '';
            
            const docxContent = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns="http://www.w3.org/TR/REC-html40">' +
            '<head><meta charset="utf-8"><title>Markdown Document</title></head>' +
            '<body>' +
                '<div style="font-family: Arial, sans-serif; line-height: 1.6; color: #333; margin: 20px;">' +
                    content +
                '</div>' +
            '</body>' +
            '</html>';
            
            const blob = new Blob(['\ufeff', docxContent], {
                type: 'application/msword'
            });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'markdown-document.doc';
            link.click();
            
            showLoading(false);
        }

        // Show/hide loading spinner
        function showLoading(show) {
            const loading = document.getElementById('loading');
            if (show) {
                loading.classList.add('active');
            } else {
                loading.classList.remove('active');
            }
        }

        // Initialize on page load
        updatePreview();
    </script>
</body>
</html>
